{"id":"bd-179","title":"MCP Agent Mail Rust: 100% feature parity + conformance + benchmarks","description":"Goal: complete the Rust port of legacy_python_mcp_agent_mail_code with 100% behavior/feature coverage, proven by fixture-based conformance tests + benchmarks (similar standard as rich_rust/beads_rust).\n\nNon-negotiables:\n- Prefer local crates over upstream ecosystem where applicable:\n  - MCP: /dp/fastmcp_rust\n  - SQLite: /dp/sqlmodel_rust\n  - IO/concurrency: /dp/asupersync (avoid tokio unless unavoidable)\n  - Console UI: /dp/frankentui\n  - Beads: /dp/beads_rust\n  - Agent detection: /dp/coding_agent_session_search\n- No destructive commands or file deletions without explicit permission.\n\nAcceptance criteria:\n-  passes\n-  passes\n- \nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 2 tests\ntest load_and_validate_fixture_schema ... ok\ntest run_fixtures_against_rust_server_router ... ok\n\ntest result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.08s\n\n\nrunning 7 tests\ntest config::tests::test_default_config ... ok\ntest error::tests::test_error_types ... ok\ntest config::tests::test_from_env ... ok\ntest error::tests::test_recoverable ... ok\ntest models::tests::test_invalid_agent_names ... ok\ntest models::tests::test_generate_agent_name ... ok\ntest models::tests::test_valid_agent_names ... ok\n\ntest result: ok. 7 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 8 tests\ntest pool::tests::test_sqlite_path_parsing ... ok\ntest timestamps::tests::test_iso_to_micros ... ok\ntest timestamps::tests::test_epoch_boundary ... ok\ntest timestamps::tests::test_negative_timestamps ... ok\ntest timestamps::tests::test_now_micros ... ok\ntest timestamps::tests::test_round_trip ... ok\ntest timestamps::tests::test_micros_to_iso ... ok\ntest pool::tests::test_schema_init_in_memory ... ok\n\ntest result: ok. 8 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 1 test\ntest crates/mcp-agent-mail-core/src/models.rs - models::is_valid_agent_name (line 318) ... ok\n\ntest result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\nall doctests ran in 0.18s; merged doctests compilation took 0.17s\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s passes\n- Conformance harness covers *all* MCP tools and resources, including error cases + nondeterministic field normalization.\n- Benchmarks include DB/tool hot paths + archive write throughput once storage layer is implemented.\n","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-02-05T05:04:26.956492167Z","created_by":"ubuntu","updated_at":"2026-02-05T05:05:57.078349046Z","closed_at":"2026-02-05T05:05:57.078301787Z","close_reason":"Superseded by br-2ei (correct prefix + clean description)","source_repo":".","compaction_level":0,"original_size":0}
{"id":"br-2ei","title":"MCP Agent Mail Rust: 100% feature parity + conformance + benchmarks","description":"Goal: complete the Rust port of legacy_python_mcp_agent_mail_code with 100% behavior/feature coverage, proven by fixture-based conformance tests + benchmarks (same bar as rich_rust/beads_rust).\n\nNon-negotiables:\n- Prefer local crates over upstream ecosystem where applicable:\n  - MCP: /dp/fastmcp_rust\n  - SQLite: /dp/sqlmodel_rust\n  - IO/concurrency: /dp/asupersync (avoid tokio unless unavoidable)\n  - Console UI: /dp/frankentui\n  - Beads: /dp/beads_rust\n  - Agent detection: /dp/coding_agent_session_search\n- No destructive commands or file deletions without explicit permission.\n\nAcceptance criteria:\n- cargo fmt --check passes\n- cargo clippy --all-targets -- -D warnings passes\n- cargo test passes\n- Conformance harness covers all MCP tools + resources (including error cases and nondeterministic-field normalization)\n- Benchmarks cover DB/tool hot paths and, once implemented, archive write throughput\n","status":"open","priority":0,"issue_type":"epic","created_at":"2026-02-05T05:05:51.223489285Z","created_by":"ubuntu","updated_at":"2026-02-05T05:05:51.223489285Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"br-2ei.1","title":"Conformance Harness: cover all tools/resources + artifact parity","description":"Expand conformance tests so they prove real feature parity, not just API-shape parity.\n\nScope:\n- Ensure python_reference.json includes cases for every MCP tool registered by Rust server (currently missing: force_release_file_reservation, install_precommit_guard, uninstall_precommit_guard).\n- Add negative/error cases per tool where legacy behavior is defined (invalid params, CONTACT_BLOCKED flows, etc).\n- Add resource query-param variants where legacy supports them.\n- Add artifact-level assertions once storage/archive layer exists (message markdown files, inbox/outbox copies, file_reservation JSON artifacts, attachment manifests).\n\nAcceptance:\n- `cargo test -p mcp-agent-mail-conformance` fails on any behavioral drift.\n- Fixtures are deterministic: normalize/ignore only genuinely nondeterministic fields (timestamps, hashes), and document why.\n\nKey files:\n- crates/mcp-agent-mail-conformance/tests/conformance/python_reference/generate_fixtures.py\n- crates/mcp-agent-mail-conformance/tests/conformance/fixtures/python_reference.json\n- crates/mcp-agent-mail-conformance/tests/conformance.rs\n","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-05T05:06:15.213350684Z","created_by":"ubuntu","updated_at":"2026-02-05T05:06:15.213350684Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.1","depends_on_id":"br-2ei","type":"parent-child","created_at":"2026-02-05T05:06:15.213350684Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.1.1","title":"Fixtures: add missing tool coverage (force_release, install/uninstall precommit guard)","description":"Extend conformance fixtures to include the currently-uncovered MCP tools.\n\nMissing tools (as of current python_reference.json):\n- force_release_file_reservation\n- install_precommit_guard\n- uninstall_precommit_guard\n\nWork:\n- Update legacy python fixture generator to exercise these tools (use temp git repo for guard install/uninstall).\n- Update Rust conformance runner to execute these calls.\n- Decide normalization strategy for nondeterministic fields (timestamps, paths).\n\nDependencies:\n- Requires real implementations in Rust (guard + force_release) so comparisons are meaningful.\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-02-05T05:10:18.916319777Z","created_by":"ubuntu","updated_at":"2026-02-05T05:10:46.050287433Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.1.1","depends_on_id":"br-2ei.1","type":"parent-child","created_at":"2026-02-05T05:10:18.916319777Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.1.1","depends_on_id":"br-2ei.2.7","type":"blocks","created_at":"2026-02-05T05:10:45.975858439Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.1.1","depends_on_id":"br-2ei.3.4","type":"blocks","created_at":"2026-02-05T05:10:46.050249291Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.1.2","title":"Fixtures: add negative/error cases (invalid params, contact enforcement, policy coercions)","description":"Add high-signal error cases to conformance so we lock in edge behavior.\n\nCandidates:\n- ensure_project: relative path -> error\n- register_agent: invalid name under strict enforcement -> error or coercion depending on config\n- send_message: CONTACT_BLOCKED / CONTACT_REQUIRED flows\n- file_reservation_paths: conflicts returned shape; TTL min enforcement\n- renew_file_reservations: invalid ids/paths\n- search_messages: FTS syntax vs LIKE fallback edge cases\n- resources: missing required query params -> error\n\nApproach:\n- Add cases to python fixture generator where legacy behavior is clear.\n- Normalize only nondeterministic fields.\n\nAcceptance:\n- Tests fail on any drift.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-05T05:10:53.695321528Z","created_by":"ubuntu","updated_at":"2026-02-05T05:10:53.695321528Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.1.2","depends_on_id":"br-2ei.1","type":"parent-child","created_at":"2026-02-05T05:10:53.695321528Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.1.3","title":"Conformance: assert git archive artifacts (messages/inbox/outbox/reservations/attachments) match legacy","description":"Extend conformance beyond JSON tool outputs to verify archive side effects.\n\nArtifacts to assert after running a fixture script:\n- messages/YYYY/MM/*.md canonical exists; parses frontmatter JSON; body matches expected.\n- agents/<Agent>/inbox + outbox copies exist and match canonical.\n- file_reservations/*.json artifacts exist for created reservations.\n- attachments manifests + WebP/originals as expected.\n\nStrategy:\n- Fixture generator should record expected relative paths and key frontmatter fields, not absolute machine paths.\n- Use hashing for large binaries; compare sha256.\n- Allow nondeterministic timestamps but assert ordering and presence.\n\nDependencies:\n- Requires storage layer implementation.\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-02-05T05:11:01.868813386Z","created_by":"ubuntu","updated_at":"2026-02-05T05:11:08.695099421Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.1.3","depends_on_id":"br-2ei.1","type":"parent-child","created_at":"2026-02-05T05:11:01.868813386Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.1.3","depends_on_id":"br-2ei.2.3","type":"blocks","created_at":"2026-02-05T05:11:08.559116758Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.1.3","depends_on_id":"br-2ei.2.4","type":"blocks","created_at":"2026-02-05T05:11:08.625107807Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.1.3","depends_on_id":"br-2ei.2.5","type":"blocks","created_at":"2026-02-05T05:11:08.695066359Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.2","title":"Storage: Git archive write/read pipeline + attachments","description":"Implement the git-backed mailbox archive described in EXISTING_MCP_AGENT_MAIL_STRUCTURE.md.\n\nThis is the core missing subsystem: legacy Python writes messages + file reservations + attachments into a per-project git repo and uses it as an auditable artifact store.\n\nScope (must match legacy behavior):\n- Archive root creation + .gitattributes\n- Per-project advisory locks (.archive.lock + owner metadata)\n- Commit batching queue (max 10, max wait 50ms)\n- Message write pipeline:\n  - canonical messages/YYYY/MM/*.md\n  - agents/<Agent>/inbox + outbox copies\n  - thread digest files (messages/threads/<thread_id>.md) if present in legacy\n  - git commit message format\n- File reservation artifacts (file_reservations/<sha1(pattern)>.json + id-<id>.json)\n- Attachment pipeline:\n  - compute content hashes\n  - convert images to WebP when enabled\n  - inline small attachments (< 64KiB) into markdown\n  - keep originals when configured\n  - write manifests + audit logs\n- Read helpers for resources that include commit metadata.\n\nConstraints:\n- Prefer git2 library (already in workspace deps); avoid shelling out when possible.\n- Prefer asupersync for IO/concurrency.\n\nAcceptance:\n- New conformance layer can assert archive artifacts exactly match legacy (file layout + frontmatter JSON + markdown body).\n- Benchmarks can measure write throughput and commit batching.\n","status":"open","priority":0,"issue_type":"epic","created_at":"2026-02-05T05:06:24.771240880Z","created_by":"ubuntu","updated_at":"2026-02-05T05:06:24.771240880Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.2","depends_on_id":"br-2ei","type":"parent-child","created_at":"2026-02-05T05:06:24.771240880Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.2.1","title":"Archive: initialize archive root + per-project git repos + .gitattributes","description":"Implement archive initialization in mcp-agent-mail-storage.\n\nRequirements:\n- Determine archive root from Config.storage_root (default ~/.mcp_agent_mail_git_mailbox_repo).\n- Ensure root exists.\n- For each project slug, ensure a git repo exists at <root>/<slug>/.\n- Ensure expected top-level dirs exist: agents/, messages/, attachments/, file_reservations/.\n- Write .gitattributes (at least: enforce LF for *.md and binary for images).\n- Ensure git author identity set from config (name/email) for commits.\n\nImplementation:\n- Use git2 to init and commit initial scaffolding if repo newly created.\n\nAcceptance:\n- Idempotent: calling multiple times does not change repo.\n- Unit test with temp dir.\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-02-05T05:09:03.245769103Z","created_by":"ubuntu","updated_at":"2026-02-05T05:09:03.245769103Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.2.1","depends_on_id":"br-2ei.2","type":"parent-child","created_at":"2026-02-05T05:09:03.245769103Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.2.2","title":"Archive: per-project advisory locks + commit batching queue","description":"Implement concurrency control for archive writes.\n\nSpec:\n- Per-project advisory lock file: <project>/.archive.lock (+ optional owner metadata JSON).\n- Commit queue batching: max 10 commits or max wait 50ms.\n- Stale lock cleanup on startup.\n\nImplementation notes:\n- Use filesystem lock (cross-platform) + busy-timeout retry. Prefer asupersync primitives if available.\n- Keep API simple for callers: `with_project_lock(project_slug, || ...)`.\n- Batching should preserve ordering for operations within a single process.\n\nAcceptance:\n- Unit tests simulate concurrent lock acquisition.\n- Bench: lock acquisition overhead is low.\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-02-05T05:09:10.275499179Z","created_by":"ubuntu","updated_at":"2026-02-05T05:09:14.942264511Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.2.2","depends_on_id":"br-2ei.2","type":"parent-child","created_at":"2026-02-05T05:09:10.275499179Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.2.2","depends_on_id":"br-2ei.2.1","type":"blocks","created_at":"2026-02-05T05:09:14.942227621Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.2.3","title":"Archive: message write pipeline (canonical + inbox/outbox + commit) + frontmatter format","description":"Implement message archival writes that mirror legacy Python.\n\nSpec (EXISTING_MCP_AGENT_MAIL_STRUCTURE.md):\n- Canonical: messages/YYYY/MM/<timestamp>__<subject_slug>__<id>.md\n- Outbox: agents/<sender>/outbox/YYYY/MM/... (same rel path)\n- Inboxes: agents/<recipient>/inbox/YYYY/MM/...\n- Frontmatter: JSON preceded by ---json header line, then Markdown body.\n- Git commit summary: \"message <id> from <sender> to <recipients>\".\n\nInputs:\n- Message record + recipients + markdown body + attachments metadata.\n\nOutputs:\n- Files written atomically.\n- Git commit performed (or batched) and commit info stored/returned where needed.\n\nAcceptance:\n- Deterministic path + slug generation.\n- Conformance can assert files exist and parse.\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-02-05T05:09:23.321591344Z","created_by":"ubuntu","updated_at":"2026-02-05T05:09:28.412372534Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.2.3","depends_on_id":"br-2ei.2","type":"parent-child","created_at":"2026-02-05T05:09:23.321591344Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.2.3","depends_on_id":"br-2ei.2.1","type":"blocks","created_at":"2026-02-05T05:09:28.340450883Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.2.3","depends_on_id":"br-2ei.2.2","type":"blocks","created_at":"2026-02-05T05:09:28.412341726Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.2.4","title":"Archive: file reservation artifacts (sha1(pattern).json + id-<id>.json)","description":"Implement archive writes for file reservations.\n\nSpec:\n- file_reservations/<sha1(path_pattern)>.json\n- file_reservations/id-<id>.json\n\nRequirements:\n- JSON includes {id, agent, path_pattern, exclusive, reason, created_ts, expires_ts, released_ts} at minimum.\n- Writes are atomic.\n- Archive writes happen on reservation create/update/release and are committed (or batched).\n\nAcceptance:\n- Resource `resource://file_reservations/{slug}` can be backed by archive artifacts (optional) and/or DB.\n- Conformance can assert artifact existence.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-05T05:09:35.083785229Z","created_by":"ubuntu","updated_at":"2026-02-05T05:09:43.133923445Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.2.4","depends_on_id":"br-2ei.2","type":"parent-child","created_at":"2026-02-05T05:09:35.083785229Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.2.4","depends_on_id":"br-2ei.2.1","type":"blocks","created_at":"2026-02-05T05:09:43.060956004Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.2.4","depends_on_id":"br-2ei.2.2","type":"blocks","created_at":"2026-02-05T05:09:43.133882798Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.2.5","title":"Archive: attachment pipeline (hashing, WebP conversion, manifests, inline small)","description":"Implement attachment handling for both tool message sending and share/export.\n\nSpec:\n- attachments/<sha1[:2]>/<sha1>.webp\n- attachments/originals/<sha1[:2]>/<sha1>.<ext>\n- attachments/_manifests/<sha1>.json\n- attachments/_audit/<sha1>.log\n\nBehavior:\n- Convert images to WebP when enabled; disable when stderr not tty? (mirror legacy policy).\n- Inline attachments <= 64KiB into markdown; store larger attachments as files and reference via manifest.\n- Optionally keep originals.\n- Ensure deterministic hashing + stable paths.\n\nAcceptance:\n- Conformance can assert archive artifacts and message frontmatter attachment refs.\n- Works cross-platform.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-05T05:09:49.770615401Z","created_by":"ubuntu","updated_at":"2026-02-05T05:09:55.806625123Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.2.5","depends_on_id":"br-2ei.2","type":"parent-child","created_at":"2026-02-05T05:09:49.770615401Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.2.5","depends_on_id":"br-2ei.2.1","type":"blocks","created_at":"2026-02-05T05:09:55.665997339Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.2.5","depends_on_id":"br-2ei.2.2","type":"blocks","created_at":"2026-02-05T05:09:55.735783587Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.2.5","depends_on_id":"br-2ei.2.3","type":"blocks","created_at":"2026-02-05T05:09:55.806593143Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.2.6","title":"Archive: read helpers + commit metadata (mailbox-with-commits/outbox/inbox views)","description":"Implement archive reads used by resources that include commit context.\n\nScope:\n- Given a canonical message path, map to git commit that introduced it.\n- Provide lightweight commit metadata (sha, summary, authored_ts) for mailbox/outbox views.\n- Support `whois(include_recent_commits=true)` by reading recent archive commits filtered by author.\n\nImplementation:\n- Prefer git2 for log traversal.\n- Cache where sensible to avoid O(N) per request.\n\nAcceptance:\n- Resource outputs match legacy Python shapes for mailbox-with-commits and whois.\n- Benchmarks cover common read paths.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-05T05:10:02.774438616Z","created_by":"ubuntu","updated_at":"2026-02-05T05:10:09.956260583Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.2.6","depends_on_id":"br-2ei.2","type":"parent-child","created_at":"2026-02-05T05:10:02.774438616Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.2.6","depends_on_id":"br-2ei.2.1","type":"blocks","created_at":"2026-02-05T05:10:09.884609532Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.2.6","depends_on_id":"br-2ei.2.3","type":"blocks","created_at":"2026-02-05T05:10:09.956223133Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.2.7","title":"Reservations: implement force_release_file_reservation (inactivity heuristics + optional notify)","description":"Implement force-release stale file reservations (MCP tool).\n\nSpec:\n- Validates reservation appears abandoned:\n  - agent inactive beyond threshold\n  - no recent mail activity\n  - no recent filesystem/git activity (archive)\n- When released, optionally notify previous holder with note.\n\nImplementation plan:\n- Define what signals we can reliably measure in Rust:\n  - agent.last_active_ts in DB\n  - message activity timestamps\n  - archive activity timestamps (last commit touching agent/mail artifacts)\n- Implement heuristics with conservative defaults and clear audit trail.\n- Write release to DB + archive artifacts.\n- If notify_previous=true: send_message to previous holder (threaded) explaining forced release.\n\nAcceptance:\n- Conformance fixture covers both allow/deny paths.\n- Safety: only force-release when heuristics strongly indicate abandonment.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-05T05:10:29.903046515Z","created_by":"ubuntu","updated_at":"2026-02-05T05:10:40.688981511Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.2.7","depends_on_id":"br-2ei.2","type":"parent-child","created_at":"2026-02-05T05:10:29.903046515Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.2.7","depends_on_id":"br-2ei.2.4","type":"blocks","created_at":"2026-02-05T05:10:40.616173280Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.2.7","depends_on_id":"br-2ei.2.6","type":"blocks","created_at":"2026-02-05T05:10:40.688947778Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.3","title":"Guard: pre-commit/pre-push enforcement + install/uninstall tooling","description":"Implement the Agent Mail guard system (pre-commit / pre-push hooks) that prevents edits when exclusive file reservations conflict.\n\nSpec source:\n- EXISTING_MCP_AGENT_MAIL_STRUCTURE.md section \"Guard Behavior (Pre-Commit / Pre-Push)\"\n\nScope:\n- `mcp-agent-mail-guard` crate:\n  - install_guard(project, repo): resolves hooks dir (core.hooksPath or default), writes chain-runner hooks, writes plugin scripts under hooks.d/<hook>.\n  - uninstall_guard(repo): removes our plugins; removes chain-runner only if safe (no other plugins) and restores .orig if applicable.\n  - guard_status(repo): reports resolved hooks path + presence of pre-commit/pre-push + mode.\n  - guard_check(repo, paths, advisory): checks active file reservations and returns conflicts (pattern, holder, expires_ts).\n- MCP tools:\n  - install_precommit_guard(project_key, code_repo_path)\n  - uninstall_precommit_guard(code_repo_path)\n  - (later) force_release_file_reservation uses similar heuristics.\n- CLI wiring:\n  - `am guard install|uninstall|status|check` should call guard crate.\n\nImplementation notes:\n- Use git2 to discover repo + read config.\n- Path matching: prefer pathspec (gitignore syntax) with fnmatch symmetric fallback.\n- Must respect env vars: AGENT_MAIL_GUARD_MODE, AGENT_MAIL_BYPASS, AGENT_NAME.\n\nAcceptance:\n- Conformance fixtures cover install/uninstall outputs.\n- Unit tests cover path matching + rename handling + worktree hooks resolution.\n","status":"open","priority":0,"issue_type":"epic","created_at":"2026-02-05T05:06:34.458664027Z","created_by":"ubuntu","updated_at":"2026-02-05T05:06:34.458664027Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.3","depends_on_id":"br-2ei","type":"parent-child","created_at":"2026-02-05T05:06:34.458664027Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.3.1","title":"Guard: resolve repo + hooks dir (core.hooksPath, worktrees) via git2","description":"Implement robust hooks directory resolution.\n\nRequirements:\n- Input: repo working tree path (code_repo_path).\n- Discover git repo (supports worktrees).\n- Determine hooks dir:\n  - If core.hooksPath is set: resolve relative to repo root per git semantics.\n  - Else: use default hooks dir for the repository common dir.\n- Return resolved hooks_dir as a real filesystem path.\n\nMust handle:\n- .git is a file containing gitdir: ...\n- worktrees where hooks live in common dir\n- bare repo (if encountered) -> treat as invalid for hook install\n\nDeliverable:\n- `mcp_agent_mail_guard::resolve_hooks_dir(repo: &Path) -> GuardResult<PathBuf>` (or equivalent internal helper) with unit tests.\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T05:07:47.277296976Z","created_by":"ubuntu","updated_at":"2026-02-05T05:18:05.735479435Z","closed_at":"2026-02-05T05:18:05.735461692Z","close_reason":"Implemented resolve_hooks_dir via git2 + commondir parsing; added unit tests incl. worktree case.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.3.1","depends_on_id":"br-2ei.3","type":"parent-child","created_at":"2026-02-05T05:07:47.277296976Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.3.2","title":"Guard: install/uninstall chain-runner hooks + agent-mail plugin scripts","description":"Implement install/uninstall mechanics (pre-commit and optionally pre-push).\n\nInstall behavior (match legacy):\n- Ensure hooks.d/<hook>/ directory exists.\n- Write/overwrite top-level hook script (chain-runner) that executes hooks.d/<hook>/* in lexical order.\n- Preserve existing non-chain hook as <hook>.orig.\n- Install our plugin under hooks.d/<hook>/50-agent-mail (or equivalent) that executes the actual guard check.\n- Create Windows shims (.cmd/.ps1) if needed to invoke the chain-runner.\n\nUninstall behavior:\n- Remove our plugins (hooks.d/<hook>/50-agent-mail.*).\n- Only remove chain-runner if it is ours AND there are no other plugins remaining AND no .orig restoration is needed.\n- If .orig exists and chain-runner is removed, restore it.\n\nDeliverables:\n- `install_guard(project_key, repo)` writes files and chmods +x on unix.\n- `uninstall_guard(repo)` removes/restores safely.\n- Unit tests use temp git repos.\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-05T05:08:05.382529734Z","created_by":"ubuntu","updated_at":"2026-02-05T05:25:45.469594914Z","closed_at":"2026-02-05T05:25:45.469578243Z","close_reason":"Implemented install_guard/uninstall_guard: resolves hooks dir, installs python chain-runner + Windows shims, installs plugin stub, preserves/restores existing hook via .orig; added unit test for preserve/restore.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.3.2","depends_on_id":"br-2ei.3","type":"parent-child","created_at":"2026-02-05T05:08:05.382529734Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.3.2","depends_on_id":"br-2ei.3.1","type":"blocks","created_at":"2026-02-05T05:08:09.551017929Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.3.3","title":"Guard: implement conflict detection (reservations + path matching + rename handling)","description":"Implement the actual guard decision logic.\n\nInputs:\n- repo path\n- list of paths to check (from staged diff for pre-commit, from commit range for pre-push)\n- AGENT_NAME env var identifies current agent\n- mode: block vs warn (AGENT_MAIL_GUARD_MODE)\n- bypass env: AGENT_MAIL_BYPASS=1\n\nLogic:\n- If guard disabled (WORKTREES_ENABLED or GIT_IDENTITY_ENABLED false): allow.\n- Load active file reservations for the project identity associated with repo (project_identity_mode logic).\n- If any exclusive reservation matches any path (symmetric matching) and reservation holder != AGENT_NAME and unexpired: conflict.\n- For renames: treat both old and new paths as touched.\n\nDeliverables:\n- Pure function that returns conflicts (pattern, holder, expires_ts) for a given path list.\n- Helper to obtain staged paths from git: use `git diff --cached --name-only -z --diff-filter=ACMRDTU` and rename pairs from `--name-status -M -z`.\n- Helper to obtain pre-push paths from stdin refs (`git rev-list`) with fallback to `git diff --name-status -M -z <remote>..<local>`.\n\nTests:\n- Synthetic reservations + path lists.\n- Temp repo with staged rename.\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-02-05T05:08:19.800578519Z","created_by":"ubuntu","updated_at":"2026-02-05T05:08:23.907637860Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.3.3","depends_on_id":"br-2ei.3","type":"parent-child","created_at":"2026-02-05T05:08:19.800578519Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.3.3","depends_on_id":"br-2ei.3.1","type":"blocks","created_at":"2026-02-05T05:08:23.907595380Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.3.4","title":"Guard: wire MCP tools install/uninstall + add conformance fixtures","description":"Connect MCP tools to the guard implementation and add conformance coverage.\n\nWork:\n- Implement `install_precommit_guard` / `uninstall_precommit_guard` in crates/mcp-agent-mail-tools/src/reservations.rs by calling mcp-agent-mail-guard.\n- Ensure tool outputs match legacy fixture shapes.\n- Extend python fixture generator to capture these tool calls (likely in a temp repo) and store expected outputs.\n- Add Rust conformance comparison.\n\nDependency:\n- Requires guard install/uninstall implementation to exist.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-05T05:08:32.548948635Z","created_by":"ubuntu","updated_at":"2026-02-05T05:08:39.237004052Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.3.4","depends_on_id":"br-2ei.3","type":"parent-child","created_at":"2026-02-05T05:08:32.548948635Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.3.4","depends_on_id":"br-2ei.3.2","type":"blocks","created_at":"2026-02-05T05:08:39.158160903Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.3.4","depends_on_id":"br-2ei.3.3","type":"blocks","created_at":"2026-02-05T05:08:39.236973625Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.3.5","title":"Guard: add unit + integration tests (git repos, worktrees, hooksPath, conflicts)","description":"Add focused tests to ensure guard behavior remains correct.\n\nTests should cover:\n- hooks dir resolution: default vs core.hooksPath vs worktree common dir.\n- install/uninstall idempotency and preservation of existing hooks.\n- path matching: pathspec (if enabled) vs fnmatch fallback.\n- conflict detection: exclusive reservations by other agent blocks; shared reservations do not.\n- rename pairs considered touched.\n\nSuccess:\n- `cargo test -p mcp-agent-mail-guard` provides strong coverage.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-05T05:08:46.185640629Z","created_by":"ubuntu","updated_at":"2026-02-05T05:08:51.467387964Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.3.5","depends_on_id":"br-2ei.3","type":"parent-child","created_at":"2026-02-05T05:08:46.185640629Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.3.5","depends_on_id":"br-2ei.3.2","type":"blocks","created_at":"2026-02-05T05:08:51.397094600Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.3.5","depends_on_id":"br-2ei.3.3","type":"blocks","created_at":"2026-02-05T05:08:51.467349671Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.4","title":"Share/Export: static bundle pipeline (SQLite snapshot + scrub + attachments + signing/encryption)","description":"Port legacy share/export pipeline to Rust (mcp-agent-mail-share + CLI).\n\nSpec source:\n- EXISTING_MCP_AGENT_MAIL_STRUCTURE.md section \"Share / Export Pipeline (Static Bundle)\"\n\nScope:\n- Snapshot SQLite safely (WAL checkpoint + sqlite backup) into export DB.\n- Apply project scoping (delete rows from other projects).\n- Scrub presets: standard/strict/archive.\n- Build FTS + materialized views; add indexes.\n- Finalize DB for export (journal_mode=DELETE, page_size=1024, VACUUM, ANALYZE).\n- Bundle attachments:\n  - Inline <= 64KiB\n  - Detach >= 25MiB\n  - Copy others into attachments/<sha256[:2]>/<sha256>.<ext>\n  - Rewrite messages.attachments JSON to bundle paths / data URIs\n- Chunk DB if >= 20MiB.\n- Bundle scaffolding: manifest.json, README, deploy hints, _headers.\n- Optional: sign manifest (Ed25519), encrypt bundle (age), package zip.\n\nConstraints:\n- Prefer sqlmodel_rust for SQLite operations.\n- Prefer asupersync for IO.\n\nAcceptance:\n- CLI commands work end-to-end on sample project.\n- Bundle is deterministic for same inputs (stable ordering + hashing).\n- Benchmarks for export path (time + output size).\n","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-05T05:06:43.381856509Z","created_by":"ubuntu","updated_at":"2026-02-05T05:06:43.381856509Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.4","depends_on_id":"br-2ei","type":"parent-child","created_at":"2026-02-05T05:06:43.381856509Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.4.1","title":"Share: SQLite snapshot + project scoping (WAL checkpoint + backup)","description":"Implement the first half of share/export.\n\nWork:\n- Open live DB with sqlmodel.\n- WAL checkpoint.\n- Use sqlite backup API to create an export DB file.\n- Apply project scope: delete rows for non-selected projects.\n\nAcceptance:\n- Export DB is consistent + passes PRAGMA integrity_check.\n- Scoped DB contains only requested projects.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-05T05:12:07.493892557Z","created_by":"ubuntu","updated_at":"2026-02-05T05:12:07.493892557Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.4.1","depends_on_id":"br-2ei.4","type":"parent-child","created_at":"2026-02-05T05:12:07.493892557Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.4.2","title":"Share: scrub presets (standard/strict/archive)","description":"Implement scrub logic on the scoped export DB.\n\nPresets:\n- standard: remove obvious secrets, keep most content\n- strict: more aggressive scrubbing\n- archive: minimal/none? (match legacy)\n\nDeliverable:\n- Deterministic scrub transformations implemented in mcp-agent-mail-share.\n- Unit tests for each preset on fixture DB.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-05T05:12:12.920255187Z","created_by":"ubuntu","updated_at":"2026-02-05T05:12:18.182967341Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.4.2","depends_on_id":"br-2ei.4","type":"parent-child","created_at":"2026-02-05T05:12:12.920255187Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.4.2","depends_on_id":"br-2ei.4.1","type":"blocks","created_at":"2026-02-05T05:12:18.182923258Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.4.3","title":"Share: build FTS/views + export-finalize DB (indexes, journal_mode=DELETE, VACUUM, ANALYZE)","description":"Implement export DB finalization.\n\nWork:\n- Build FTS index + any materialized views required by the static viewer.\n- Add export-only indexes (subject_lower, sender_lower).\n- Finalize pragmas: journal_mode=DELETE, page_size=1024.\n- VACUUM + ANALYZE.\n\nAcceptance:\n- Export DB is compact and queryable.\n- Viewer can run against it.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-05T05:12:24.355619779Z","created_by":"ubuntu","updated_at":"2026-02-05T05:12:30.596793011Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.4.3","depends_on_id":"br-2ei.4","type":"parent-child","created_at":"2026-02-05T05:12:24.355619779Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.4.3","depends_on_id":"br-2ei.4.2","type":"blocks","created_at":"2026-02-05T05:12:30.596738949Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.4.4","title":"Share: bundle attachments + rewrite messages.attachments JSON","description":"Implement attachment bundling for share/export.\n\nRules:\n- Inline <= 64KiB\n- Detach >= 25MiB\n- Copy others to attachments/<sha256[:2]>/<sha256>.<ext>\n- Rewrite messages.attachments JSON to bundle paths / data URIs\n\nAcceptance:\n- Bundle contains referenced attachment paths.\n- Large detached attachments are marked and not copied.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-05T05:12:37.955382434Z","created_by":"ubuntu","updated_at":"2026-02-05T05:12:46.141914497Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.4.4","depends_on_id":"br-2ei.2.5","type":"blocks","created_at":"2026-02-05T05:12:46.141880664Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.4.4","depends_on_id":"br-2ei.4","type":"parent-child","created_at":"2026-02-05T05:12:37.955382434Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.4.4","depends_on_id":"br-2ei.4.2","type":"blocks","created_at":"2026-02-05T05:12:46.064558399Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.4.5","title":"Share: chunking + manifest/scaffolding + viewer assets","description":"Finish bundle packaging after DB + attachments are ready.\n\nWork:\n- If DB >= 20MiB: chunk into chunks/ + mailbox.sqlite3.config.json.\n- Copy static viewer assets.\n- Write manifest.json including export_config, project_scope, scrub info, db info, attachment info.\n- Write README + deploy hints + _headers.\n\nAcceptance:\n- Bundle directory is self-contained and previewable.\n- Manifest schema is stable for automation.\n","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-05T05:12:55.110282213Z","created_by":"ubuntu","updated_at":"2026-02-05T05:12:59.885960001Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.4.5","depends_on_id":"br-2ei.4","type":"parent-child","created_at":"2026-02-05T05:12:55.110282213Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.4.5","depends_on_id":"br-2ei.4.3","type":"blocks","created_at":"2026-02-05T05:12:59.808825340Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.4.5","depends_on_id":"br-2ei.4.4","type":"blocks","created_at":"2026-02-05T05:12:59.885904577Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.4.6","title":"Share: optional signing (Ed25519) + encryption (age) + zip packaging","description":"Implement optional bundle hardening features.\n\nWork:\n- Generate signing key if requested; write public key.\n- Sign manifest.json and include signature in bundle.\n- Encrypt bundle with age recipients; emit .age output.\n- Zip packaging.\n\nAcceptance:\n- verify/decrypt commands succeed.\n- Clear UX and error messages.\n","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-05T05:13:06.191406916Z","created_by":"ubuntu","updated_at":"2026-02-05T05:13:11.249769695Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.4.6","depends_on_id":"br-2ei.4","type":"parent-child","created_at":"2026-02-05T05:13:06.191406916Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.4.6","depends_on_id":"br-2ei.4.5","type":"blocks","created_at":"2026-02-05T05:13:11.249727695Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.5","title":"CLI Parity: implement Typer-equivalent commands + frankentui output","description":"Complete the Rust CLI (crates/mcp-agent-mail-cli) to match legacy Python Typer commands.\n\nScope:\n- Serve commands: serve-http, serve-stdio.\n- share subcommands (delegates to mcp-agent-mail-share).\n- guard subcommands (delegates to mcp-agent-mail-guard).\n- doctor commands (diagnostics + repair scaffolding).\n- projects/products/mail helper commands.\n- acks/file_reservations views.\n\nOutput constraints:\n- Use frankentui for all console rendering (tables, colors, progress).\n- Keep JSON modes stable for automation.\n\nAcceptance:\n- Command surface matches legacy (names, flags, defaults, exit codes) unless we intentionally improve and document.\n- End-to-end scripts in scripts/ (if any) pass.\n","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-05T05:06:50.526774224Z","created_by":"ubuntu","updated_at":"2026-02-05T05:06:50.526774224Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.5","depends_on_id":"br-2ei","type":"parent-child","created_at":"2026-02-05T05:06:50.526774224Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.5.1","title":"CLI: serve-http/serve-stdio parity (flags, defaults, exit codes)","description":"Ensure `am serve-http` and `am serve-stdio` behave like legacy CLI.\n\nRequirements:\n- Flags: --host/--port/--path override env defaults.\n- serve-http starts HTTP listener with configured base path.\n- serve-stdio runs fastmcp stdio transport.\n- Exit codes: non-zero on bind failures.\n\nAcceptance:\n- Manual smoke tests with curl and stdio.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-05T05:11:18.491790676Z","created_by":"ubuntu","updated_at":"2026-02-05T05:11:18.491790676Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.5.1","depends_on_id":"br-2ei.5","type":"parent-child","created_at":"2026-02-05T05:11:18.491790676Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.5.2","title":"CLI: implement guard subcommands (install/uninstall/status/check)","description":"Wire `am guard ...` commands to mcp-agent-mail-guard.\n\nCommands:\n- am guard install [--repo PATH] [--prepush]\n- am guard uninstall [--repo PATH]\n- am guard status [--repo PATH]\n- am guard check [--repo PATH] [--advisory] (used by hook plugin)\n\nMust match legacy defaults and env vars.\n\nDependencies:\n- Requires guard crate implementation (br-2ei.3.*).\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-02-05T05:11:24.884001192Z","created_by":"ubuntu","updated_at":"2026-02-05T05:11:33.221080376Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.5.2","depends_on_id":"br-2ei.3.2","type":"blocks","created_at":"2026-02-05T05:11:33.144888641Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.5.2","depends_on_id":"br-2ei.3.3","type":"blocks","created_at":"2026-02-05T05:11:33.221041253Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.5.2","depends_on_id":"br-2ei.5","type":"parent-child","created_at":"2026-02-05T05:11:24.884001192Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.5.3","title":"CLI: implement share subcommands (export/update/preview/verify/decrypt/wizard)","description":"Wire `am share ...` commands to mcp-agent-mail-share.\n\nCommands should accept the same flags as legacy Typer, including defaults and interactive modes.\n\nDependencies:\n- Requires share/export implementation (br-2ei.4).\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-05T05:11:39.240636392Z","created_by":"ubuntu","updated_at":"2026-02-05T05:11:45.440799957Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.5.3","depends_on_id":"br-2ei.4","type":"blocks","created_at":"2026-02-05T05:11:45.440762998Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.5.3","depends_on_id":"br-2ei.5","type":"parent-child","created_at":"2026-02-05T05:11:39.240636392Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.5.4","title":"CLI: implement doctor commands (check/repair/backups/restore)","description":"Port legacy doctor commands for diagnostics and repair workflows.\n\nScope:\n- check: environment, DB connectivity, archive repo health, locks.\n- repair: safe non-destructive repairs (unlock stale locks, recreate dirs, etc).\n- backups/restore: archive/db snapshot helpers.\n\nConstraints:\n- Must not run destructive git/fs commands; prefer safe copies and explicit confirmations.\n\nAcceptance:\n- Can diagnose typical CI/dev failures with actionable output.\n","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-05T05:11:51.799905939Z","created_by":"ubuntu","updated_at":"2026-02-05T05:11:51.799905939Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.5.4","depends_on_id":"br-2ei.5","type":"parent-child","created_at":"2026-02-05T05:11:51.799905939Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.5.5","title":"CLI UX: frankentui rendering for tables/progress + JSON output modes","description":"Replace placeholder println output with frankentui-based rendering for all CLI commands.\n\nRequirements:\n- Human mode: colorful tables, aligned columns, progress for long ops.\n- Machine mode: stable JSON schemas for automation.\n- TTY detection: disable colors when not a TTY.\n\nAcceptance:\n- CLI output matches legacy expectations and is pleasant for humans.\n","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-05T05:11:59.633674324Z","created_by":"ubuntu","updated_at":"2026-02-05T05:11:59.633674324Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.5.5","depends_on_id":"br-2ei.5","type":"parent-child","created_at":"2026-02-05T05:11:59.633674324Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.6","title":"Integration: enforce local-crate usage (asupersync/sqlmodel/fastmcp/frankentui) + agent detection","description":"Ensure the port fully leverages the local /dp crates and avoids redundant upstream deps.\n\nScope:\n- Audit for tokio usage; replace with asupersync where feasible.\n- Ensure SQLite access flows through sqlmodel_rust (no rusqlite, no raw sqlite3 shellouts).\n- Ensure server uses fastmcp_rust transports.\n- Ensure all CLI UI uses frankentui.\n- Integrate /dp/coding_agent_session_search for detecting installed coding agents (or port its logic to a tokio-free module if needed).\n\nAcceptance:\n- `rg tokio` yields no runtime tokio dependencies in mcp-agent-mail crates (except optional isolated feature if truly required).\n- Clear module boundaries: core/db/storage/tools/server/cli/guard/share.\n","status":"open","priority":2,"issue_type":"epic","created_at":"2026-02-05T05:06:57.327442629Z","created_by":"ubuntu","updated_at":"2026-02-05T05:06:57.327442629Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.6","depends_on_id":"br-2ei","type":"parent-child","created_at":"2026-02-05T05:06:57.327442629Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.6.1","title":"Audit: eliminate tokio and upstream duplicates (use asupersync/sqlmodel)","description":"Audit the workspace for accidental dependencies/usage.\n\nChecklist:\n- `rg tokio` across crates/; remove runtime tokio where possible.\n- Ensure SQLite access goes through sqlmodel_rust (no rusqlite).\n- Ensure async/concurrency uses asupersync.\n\nAcceptance:\n- cargo tree shows no unintended tokio runtime dependencies.\n","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-05T05:13:17.777775741Z","created_by":"ubuntu","updated_at":"2026-02-05T05:13:17.777775741Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.6.1","depends_on_id":"br-2ei.6","type":"parent-child","created_at":"2026-02-05T05:13:17.777775741Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.6.2","title":"Integrate coding_agent_session_search for installed-agent detection (tokio-free surface)","description":"Port/integrate agent detection so Agent Mail can identify installed coding agents.\n\nSource:\n- /dp/coding_agent_session_search\n\nWork:\n- Determine minimal API needed (e.g., list running sessions / detect installed CLIs).\n- If upstream crate is tokio-heavy, isolate behind optional feature or re-port logic to asupersync.\n- Expose results via CLI `am doctor` and/or resources.\n\nAcceptance:\n- Works on dev machine; no tokio runtime required for core server.\n","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-05T05:13:25.051447400Z","created_by":"ubuntu","updated_at":"2026-02-05T05:13:25.051447400Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.6.2","depends_on_id":"br-2ei.6","type":"parent-child","created_at":"2026-02-05T05:13:25.051447400Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.7","title":"Benchmarks: tool latency + archive throughput + share/export budgets","description":"Expand Criterion benches to cover realistic hot paths.\n\nExisting:\n- crates/mcp-agent-mail/benches/benchmarks.rs seeds DB using conformance fixtures and measures representative tool calls.\n\nAdd:\n- Archive write throughput benchmarks once storage layer exists (message write + commit batching).\n- Guard check performance on large path lists.\n- Share/export pipeline benchmarks (snapshot + scrub + bundle) with size/throughput budgets.\n\nMethod:\n- Use extreme-software-optimization loop: baseline (hyperfine), profile (cargo flamegraph), prove behavior unchanged via golden outputs.\n\nAcceptance:\n- Bench suite runs in CI (or nightly) and enforces regression budgets.\n","status":"open","priority":2,"issue_type":"epic","created_at":"2026-02-05T05:07:03.312826328Z","created_by":"ubuntu","updated_at":"2026-02-05T05:07:03.312826328Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.7","depends_on_id":"br-2ei","type":"parent-child","created_at":"2026-02-05T05:07:03.312826328Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.7.1","title":"Bench: establish baseline budgets + golden outputs for hot tool paths","description":"Capture baseline performance numbers and lock them in.\n\nWork:\n- Run existing Criterion benches.\n- Add hyperfine scripts for representative calls.\n- Capture golden output hashes where applicable.\n\nAcceptance:\n- Documented budgets in README or benches module.\n","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-05T05:13:31.777132727Z","created_by":"ubuntu","updated_at":"2026-02-05T05:13:31.777132727Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.7.1","depends_on_id":"br-2ei.7","type":"parent-child","created_at":"2026-02-05T05:13:31.777132727Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.7.2","title":"Bench: archive write throughput (message + attachments + commit batching)","description":"Add benchmarks for archive writes.\n\nDependencies:\n- Requires storage layer write pipeline + attachments + batching (br-2ei.2.*).\n\nWork:\n- Seed realistic message payloads (use conformance fixtures).\n- Measure end-to-end: write canonical+inbox/outbox + commit batching.\n- Report throughput (msgs/sec) and p95 latency.\n","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-05T05:13:37.368254570Z","created_by":"ubuntu","updated_at":"2026-02-05T05:13:45.123731615Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.7.2","depends_on_id":"br-2ei.2.2","type":"blocks","created_at":"2026-02-05T05:13:45.123697160Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.7.2","depends_on_id":"br-2ei.2.5","type":"blocks","created_at":"2026-02-05T05:13:45.048457369Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.7.2","depends_on_id":"br-2ei.7","type":"parent-child","created_at":"2026-02-05T05:13:37.368254570Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.7.3","title":"Bench: share/export pipeline (snapshot+scrub+bundle) budgets","description":"Add benchmarks for share/export.\n\nDependencies:\n- Requires share pipeline implementation (br-2ei.4.*).\n\nWork:\n- Measure end-to-end export for representative DB sizes.\n- Track output size and runtime.\n- Identify hot spots via flamegraph before optimizing.\n","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-05T05:13:51.914580151Z","created_by":"ubuntu","updated_at":"2026-02-05T05:13:56.382594994Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.7.3","depends_on_id":"br-2ei.4.5","type":"blocks","created_at":"2026-02-05T05:13:56.382556972Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"br-2ei.7.3","depends_on_id":"br-2ei.7","type":"parent-child","created_at":"2026-02-05T05:13:51.914580151Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"br-2ei.8","title":"Docs: add Rust-port README + dev workflow (fmt/clippy/test/conformance/bench)","description":"Add a top-level README.md for this Rust port.\n\nMust include:\n- What the project is (Rust port of mcp_agent_mail)\n- How to run MCP server: stdio and HTTP\n- How to run conformance tests\n- How to regenerate fixtures (legacy venv python command)\n- How to run benches\n- Notes on per-agent CARGO_TARGET_DIR to avoid multi-agent target lock contention\n\nAcceptance:\n- README is accurate and matches current code + scripts.\n","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-05T05:07:09.183372429Z","created_by":"ubuntu","updated_at":"2026-02-05T05:07:09.183372429Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"br-2ei.8","depends_on_id":"br-2ei","type":"parent-child","created_at":"2026-02-05T05:07:09.183372429Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
